import{_ as W}from"./refresh-83571ede.js";import{_ as Z}from"./round-plus-f1fff6bd.js";import{u as ee}from"./use-loading-62d2aacf.js";import{d as ae,bm as le,r as p,aX as a,ae as u,aY as m,h as $,b7 as te,aO as ne,aP as se,aS as t,aQ as T,aT as n,aU as U,bF as oe,b3 as de}from"./index-e9ed0e0e.js";import{c as j,a as ie}from"./rule-7c323978.js";import{n as ue,l as me,o as re,m as pe,s as ce}from"./dynamic-41b1b26f.js";import{N as R}from"./Popconfirm-d647cf5b.js";import{_ as i}from"./Space-5f39c62b.js";import{_ as N}from"./Input-dd6f5e07.js";import{_ as fe}from"./Select-227e2db3.js";import{_ as _e}from"./DataTable-281d2743.js";import{_ as ve,a as be}from"./Grid-034146f3.js";import{_ as ge}from"./FormItemGridItem-6f6a168c.js";import"./format-length-c9d165c6.js";import"./get-c6b7aef5.js";import"./Popover-0534a616.js";import"./Suffix-bca8596e.js";import"./cssr-11db33b0.js";import"./use-merged-state-496c4ad7.js";import"./use-compitable-74186af3.js";import"./next-frame-once-7035a838.js";import"./Tag-b8d65896.js";import"./Checkbox-98c4e004.js";import"./Dropdown-a3ff842e.js";const ye={class:"overflow-hidden"},he={class:"flex-col h-full"},xe=T("span",{style:{"font-size":"12px",color:"red"}}," 注意：表名不要有特殊符号，推荐用驼峰命名！",-1),Ce={class:"flex-col h-full"},Ne=T("span",{style:{"font-size":"12px",color:"red"}}," 注意：字段名称不要有特殊符号，推荐用驼峰命名，接口调试的时候字段值需要和这里的字段类型对应！",-1),Je=ae({__name:"index",setup(Te){const{loading:y,startLoading:h,endLoading:x}=ee(!1),k=le().userInfo,z=p([]),_=p(),v=p(!1),c=p({tenantId:k.Id,tableName:"",tableComment:""}),F={tableName:j("请输入数据表名"),tableComment:j("请输入数据表描述")},B=p(),w=()=>{c.value={tenantId:k.id,tableName:"",tableComment:""}},L=()=>{w(),v.value=!0},S=()=>{w(),v.value=!1},E=async()=>{var l,s;await((l=B.value)==null?void 0:l.validate());const e=await re(c.value);e.data.code===200&&((s=window.$message)==null||s.success(e.data.msg),v.value=!1,b())};async function O(){h();const e=await pe({tenantId:k.id});e.data.code===200&&(z.value=e.data.data,o.value=[]),x()}const I=p([{key:"index",title:"序号",align:"center",render:(e,l)=>`${l+1}`},{key:"tableName",title:"表名",align:"center"},{key:"tableComment",title:"描述",align:"center"},{key:"actions",title:"操作",align:"center",width:280,render:e=>a(i,{justify:"space-around"},{default:()=>[a(u,{size:"small",onClick:()=>P(e.id)},{default:()=>[m("字段管理")]}),a(R,{onPositiveClick:()=>q(e.id)},{default:()=>"确认删除表",trigger:()=>a(u,{size:"small"},{default:()=>[m("删除")]})})]})}]);async function q(e){var s;h();const l=await ue({id:e});l.data.code===200&&((s=window.$message)==null||s.success(l.data.msg),b()),x()}const o=p([]),P=async e=>{_.value=e,h();const l=await me({tableId:e});l.data.code===200&&(o.value=l.data.data),x()},G=()=>{var e;if(!_.value||_.value===0){(e=window.$message)==null||e.error("请选择数据表！");return}P(_.value)},M=()=>{o.value.push({tableId:_.value,fieldName:"",fieldType:"",fieldComment:""})},Q=e=>{let l=o.value.findIndex(s=>s.fieldName==e);l>-1&&o.value.splice(l)},X=async()=>{var s,f,C,g;if(o.value.length===0){(s=window.$message)==null||s.error("请添加字段！");return}if(o.value.findIndex(d=>d.fieldType==="")>-1){(f=window.$message)==null||f.error("请添加字段类型！");return}if(o.value.findIndex(d=>d.fieldName==="")>-1){(C=window.$message)==null||C.error("请添加字段名称！");return}h();const e=[];o.value.forEach(d=>{e.push({tableId:d.tableId,fieldName:d.fieldName,fieldType:d.fieldType,fieldComment:d.fieldComment})});const l=await ce(e);l.data.code===200&&((g=window.$message)==null||g.success(l.data.msg),b(),o.value=[]),x()},Y=[{label:"字符串",value:"varchar"},{label:"长文本",value:"longtext"},{label:"长整数",value:"long"},{label:"整数",value:"int"},{label:"金额",value:"decimal"},{label:"浮点",value:"float"},{label:"日期",value:"datetime"},{label:"布尔型",value:"bool"}],H=p([{key:"index",title:"序号",align:"center",width:80,render:(e,l)=>`${l+1}`},{title:"字段名称",key:"fieldName",render(e,l){return $(N,{key:l,value:e.fieldName,disabled:e.fieldName==="Id"||e.fieldName==="CreateTime"||e.fieldName==="UpdateTime",onUpdateValue(s){o.value[l].fieldName=s}})}},{title:"字段类型",key:"fieldType",render(e,l){return $(fe,{key:l,options:Y,disabled:e.fieldName==="Id"||e.fieldName==="CreateTime"||e.fieldName==="UpdateTime",value:e.fieldType,onUpdateValue(s){o.value[l].fieldType=s}})}},{title:"字段描述",key:"fieldComment",render(e,l){return $(N,{key:l,value:e.fieldComment,disabled:e.fieldName==="Id"||e.fieldName==="CreateTime"||e.fieldName==="UpdateTime",onUpdateValue(s){o.value[l].fieldComment=s}})}},{key:"actions",title:"操作",align:"center",render:e=>a(i,{justify:"space-around"},{default:()=>[a(R,{onPositiveClick:()=>Q(e.fieldName)},{default:()=>"确认删除该字段",trigger:()=>a(u,{disabled:e.fieldName==="Id"||e.fieldName==="CreateTime"||e.fieldName==="UpdateTime",size:"small"},{default:()=>[m("删除")]})})]})}]);async function b(){O(),w()}return b(),(e,l)=>{const s=Z,f=W,C=te("column-setting"),g=_e,d=oe,A=ve,D=be,V=ge,J=ie,K=de;return ne(),se("div",ye,[a(D,{cols:24,class:"h-full"},{default:t(()=>[a(A,{span:12},{default:t(()=>[a(d,{title:"数据表管理",bordered:!1,class:"h-full rounded-8px shadow-sm"},{default:t(()=>[T("div",he,[a(n(i),{class:"pb-12px",justify:"space-between"},{default:t(()=>[a(n(i),null,{default:t(()=>[a(n(u),{type:"primary",onClick:L},{default:t(()=>[a(s,{class:"mr-4px text-20px"}),m(" 新增 ")]),_:1})]),_:1}),a(n(i),{align:"center",size:18},{default:t(()=>[a(n(u),{size:"small",type:"primary",onClick:b},{default:t(()=>[a(f,{class:U(["mr-4px text-16px",{"animate-spin":n(y)}])},null,8,["class"]),m(" 刷新表格 ")]),_:1}),a(C,{columns:I.value,"onUpdate:columns":l[0]||(l[0]=r=>I.value=r)},null,8,["columns"])]),_:1})]),_:1}),a(n(i),null,{default:t(()=>[xe]),_:1}),a(g,{columns:I.value,data:z.value,remote:"",loading:n(y),"flex-height":"",class:"flex-1-hidden mt-5"},null,8,["columns","data","loading"])])]),_:1})]),_:1}),a(A,{span:12},{default:t(()=>[a(d,{title:"字段管理",bordered:!1,class:"h-full rounded-8px shadow-sm"},{default:t(()=>[T("div",Ce,[a(n(i),{class:"pb-12px",justify:"space-between"},{default:t(()=>[a(n(i),null,{default:t(()=>[a(n(u),{type:"primary",onClick:l[1]||(l[1]=r=>M())},{default:t(()=>[a(s,{class:"mr-4px text-20px"}),m(" 新增一行 ")]),_:1})]),_:1}),a(n(i),null,{default:t(()=>[a(n(u),{type:"primary",onClick:X},{default:t(()=>[a(f,{class:U(["mr-4px text-16px",{"animate-spin":n(y)}])},null,8,["class"]),m(" 保存 ")]),_:1}),a(n(u),{type:"primary",onClick:G},{default:t(()=>[a(f,{class:U(["mr-4px text-16px",{"animate-spin":n(y)}])},null,8,["class"]),m(" 重置 ")]),_:1})]),_:1})]),_:1}),a(n(i),null,{default:t(()=>[Ne]),_:1}),a(g,{columns:H.value,data:o.value,"flex-height":"",class:"flex-1-hidden mt-5"},null,8,["columns","data"])])]),_:1})]),_:1})]),_:1}),a(K,{show:v.value,"onUpdate:show":l[4]||(l[4]=r=>v.value=r),preset:"card",title:"创建数据表",class:"w-700px"},{default:t(()=>[a(J,{ref_key:"formRef",ref:B,"label-placement":"left","label-width":120,model:c.value,rules:F},{default:t(()=>[a(D,{cols:24,"x-gap":18},{default:t(()=>[a(V,{span:24,label:"数据表名",path:"tableName"},{default:t(()=>[a(n(N),{value:c.value.tableName,"onUpdate:value":l[2]||(l[2]=r=>c.value.tableName=r)},null,8,["value"])]),_:1}),a(V,{span:24,label:"数据表注释",path:"tableComment"},{default:t(()=>[a(n(N),{value:c.value.tableComment,"onUpdate:value":l[3]||(l[3]=r=>c.value.tableComment=r)},null,8,["value"])]),_:1})]),_:1}),a(n(i),{class:"w-full pt-16px",size:24,justify:"end"},{default:t(()=>[a(n(u),{class:"w-72px",onClick:S},{default:t(()=>[m("取消")]),_:1}),a(n(u),{class:"w-72px",type:"primary",onClick:E},{default:t(()=>[m("确定")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}});export{Je as default};
