import{d as S,r as y,B as f,aM as F,aN as he,a4 as Y,aO as be,aP as ye,aQ as xe,aR as Ce,aS as Pe,aT as M,aj as J,aU as Te,x as O,aI as ke,aV as G,aW as K,aX as Ne,aY as we,X as g,aZ as Ie,a_ as Be,aC as q,aF as U,aB as W,ak as ee,a$ as $e,b0 as ze,b1 as je,b2 as Se,b3 as Re,b4 as X,o as te,f as ae,g as $,as as Oe,p as e,S as C,Z as j,a0 as Ue,e as Ve,i as s,V as c,s as V,a2 as Fe,a3 as Ae,a5 as Le,b5 as De,b6 as Ee}from"./index-BZUOWCTQ.js";import{j as Me,h as Ge,k as Ke,i as qe,s as We,_ as Xe}from"./dynamic-gU_5PGvA.js";import{_ as b}from"./Space-CUMox7Fx.js";const Ze=Object.assign(Object.assign({},be),ye),He=S({__GRID_ITEM__:!0,name:"FormItemGridItem",alias:["FormItemGi"],props:Ze,setup(){const n=y(null);return{formItemInstRef:n,validate:(...l)=>{const{value:_}=n;if(_)return _.validate(...l)},restoreValidation:()=>{const{value:l}=n;l&&l.restoreValidation()}}},render(){return f(Y,F(this.$.vnode.props||{},Ce),{default:()=>{const n=F(this.$props,xe);return f(he,Object.assign({ref:"formItemInstRef"},n),this.$slots)}})}}),ne=Pe("n-popconfirm"),le={positiveText:String,negativeText:String,showIcon:{type:Boolean,default:!0},onPositiveClick:{type:Function,required:!0},onNegativeClick:{type:Function,required:!0}},Z=we(le),Qe=S({name:"NPopconfirmPanel",props:le,setup(n){const{localeRef:o}=M("Popconfirm"),{inlineThemeDisabled:i}=J(),{mergedClsPrefixRef:l,mergedThemeRef:_,props:v}=Te(ne),T=O(()=>{const{common:{cubicBezierEaseInOut:r},self:{fontSize:p,iconSize:P,iconColor:k}}=_.value;return{"--n-bezier":r,"--n-font-size":p,"--n-icon-size":P,"--n-icon-color":k}}),d=i?ke("popconfirm-panel",void 0,T,v):void 0;return Object.assign(Object.assign({},M("Popconfirm")),{mergedClsPrefix:l,cssVars:i?void 0:T,localizedPositiveText:O(()=>n.positiveText||o.value.positiveText),localizedNegativeText:O(()=>n.negativeText||o.value.negativeText),positiveButtonProps:G(v,"positiveButtonProps"),negativeButtonProps:G(v,"negativeButtonProps"),handlePositiveClick(r){n.onPositiveClick(r)},handleNegativeClick(r){n.onNegativeClick(r)},themeClass:d==null?void 0:d.themeClass,onRender:d==null?void 0:d.onRender})},render(){var n;const{mergedClsPrefix:o,showIcon:i,$slots:l}=this,_=K(l.action,()=>this.negativeText===null&&this.positiveText===null?[]:[this.negativeText!==null&&f(g,Object.assign({size:"small",onClick:this.handleNegativeClick},this.negativeButtonProps),{default:()=>this.localizedNegativeText}),this.positiveText!==null&&f(g,Object.assign({size:"small",type:"primary",onClick:this.handlePositiveClick},this.positiveButtonProps),{default:()=>this.localizedPositiveText})]);return(n=this.onRender)===null||n===void 0||n.call(this),f("div",{class:[`${o}-popconfirm__panel`,this.themeClass],style:this.cssVars},Ne(l.default,v=>i||v?f("div",{class:`${o}-popconfirm__body`},i?f("div",{class:`${o}-popconfirm__icon`},K(l.icon,()=>[f(Ie,{clsPrefix:o},{default:()=>f(Be,null)})])):null,v):null),_?f("div",{class:[`${o}-popconfirm__action`]},_):null)}}),Ye=q("popconfirm",[U("body",`
 font-size: var(--n-font-size);
 display: flex;
 align-items: center;
 flex-wrap: nowrap;
 position: relative;
 `,[U("icon",`
 display: flex;
 font-size: var(--n-icon-size);
 color: var(--n-icon-color);
 transition: color .3s var(--n-bezier);
 margin: 0 8px 0 0;
 `)]),U("action",`
 display: flex;
 justify-content: flex-end;
 `,[W("&:not(:first-child)","margin-top: 8px"),q("button",[W("&:not(:last-child)","margin-right: 8px;")])])]),Je=Object.assign(Object.assign(Object.assign({},ee.props),Se),{positiveText:String,negativeText:String,showIcon:{type:Boolean,default:!0},trigger:{type:String,default:"click"},positiveButtonProps:Object,negativeButtonProps:Object,onPositiveClick:Function,onNegativeClick:Function}),H=S({name:"Popconfirm",props:Je,__popover__:!0,setup(n){const{mergedClsPrefixRef:o}=J(),i=ee("Popconfirm","-popconfirm",Ye,Re,n,o),l=y(null);function _(d){var r;if(!(!((r=l.value)===null||r===void 0)&&r.getMergedShow()))return;const{onPositiveClick:p,"onUpdate:show":P}=n;Promise.resolve(p?p(d):!0).then(k=>{var h;k!==!1&&((h=l.value)===null||h===void 0||h.setShow(!1),P&&X(P,!1))})}function v(d){var r;if(!(!((r=l.value)===null||r===void 0)&&r.getMergedShow()))return;const{onNegativeClick:p,"onUpdate:show":P}=n;Promise.resolve(p?p(d):!0).then(k=>{var h;k!==!1&&((h=l.value)===null||h===void 0||h.setShow(!1),P&&X(P,!1))})}return $e(ne,{mergedThemeRef:i,mergedClsPrefixRef:o,props:n}),{setShow(d){var r;(r=l.value)===null||r===void 0||r.setShow(d)},syncPosition(){var d;(d=l.value)===null||d===void 0||d.syncPosition()},mergedTheme:i,popoverInstRef:l,handlePositiveClick:_,handleNegativeClick:v}},render(){const{$slots:n,$props:o,mergedTheme:i}=this;return f(je,ze(o,Z,{theme:i.peers.Popover,themeOverrides:i.peerOverrides.Popover,internalExtraClass:["popconfirm"],ref:"popoverInstRef"}),{trigger:n.activator||n.trigger,default:()=>{const l=F(o,Z);return f(Qe,Object.assign(Object.assign({},l),{onPositiveClick:this.handlePositiveClick,onNegativeClick:this.handleNegativeClick}),n)}})}}),et={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},tt=$("path",{fill:"currentColor",d:"M17.65 6.35A7.96 7.96 0 0 0 12 4a8 8 0 0 0-8 8a8 8 0 0 0 8 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18a6 6 0 0 1-6-6a6 6 0 0 1 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"},null,-1),at=[tt];function nt(n,o){return te(),ae("svg",et,[...at])}const lt={name:"mdi-refresh",render:nt};function ot(n=!1){const o=y(n);function i(T){o.value=T}function l(){i(!0)}function _(){i(!1)}function v(){i(!o.value)}return{bool:o,setBool:i,setTrue:l,setFalse:_,toggle:v}}function st(n=!1){const{bool:o,setTrue:i,setFalse:l}=ot(n);return{loading:o,startLoading:i,endLoading:l}}const Q=(n="不能为空")=>({required:!0,message:n}),it={class:"overflow-hidden"},rt={class:"flex-col h-full"},dt=$("span",{style:{"font-size":"12px",color:"red"}}," 注意：表名不要有特殊符号，推荐用驼峰命名！",-1),ct={class:"flex-col h-full"},ut=$("span",{style:{"font-size":"12px",color:"red"}}," 注意：字段名称不要有特殊符号，推荐用驼峰命名，接口调试的时候字段值需要和这里的字段类型对应！",-1),vt=S({name:"dynamic_database",__name:"index",setup(n){const{loading:o,startLoading:i,endLoading:l}=st(!1),v=Oe().userInfo,T=y([]),d=y(),r=y(!1),p=y({tenantId:v.Id,tableName:"",tableComment:""}),P={tableName:Q("请输入数据表名"),tableComment:Q("请输入数据表描述")},k=y(),h=()=>{p.value={tenantId:v.id,tableName:"",tableComment:""}},oe=()=>{h(),r.value=!0},se=()=>{h(),r.value=!1},ie=async()=>{var a,u;await((a=k.value)==null?void 0:a.validate()),await Ke(p.value)&&((u=window.$message)==null||u.success("操作成功"),r.value=!1,I())};async function re(){i();const t=await qe();t.data&&(T.value=t.data,m.value=[]),l()}const R=y([{key:"index",title:"序号",align:"center",render:(t,a)=>`${a+1}`},{key:"tableName",title:"表名",align:"center"},{key:"tableComment",title:"描述",align:"center"},{key:"actions",title:"操作",align:"center",width:280,render:t=>e(b,{justify:"space-around"},{default:()=>[e(g,{size:"small",onClick:()=>A(t.id)},{default:()=>[C("字段管理")]}),e(H,{onPositiveClick:()=>de(t.id)},{default:()=>"确认删除表",trigger:()=>e(g,{size:"small"},{default:()=>[C("删除")]})})]})}]);async function de(t){var u;i(),await Me({id:t})&&((u=window.$message)==null||u.success("删除成功"),I()),l()}const m=y([]),A=async t=>{d.value=t,i();const a=await Ge({tableId:t});console.log(a),a&&(m.value=a.data),l()},ce=()=>{var t;if(!d.value||d.value===0){(t=window.$message)==null||t.error("请选择数据表！");return}A(d.value)},ue=()=>{m.value.push({fieldName:"",fieldType:"",fieldComment:""})},pe=t=>{let a=m.value.findIndex(u=>u.fieldName==t);a>-1&&m.value.splice(a)},fe=async()=>{var u,w,z,B;if(m.value.length===0){(u=window.$message)==null||u.error("请添加字段！");return}if(m.value.findIndex(x=>x.fieldType==="")>-1){(w=window.$message)==null||w.error("请添加字段类型！");return}if(m.value.findIndex(x=>x.fieldName==="")>-1){(z=window.$message)==null||z.error("请添加字段名称！");return}i();const t=[];m.value.forEach(x=>{t.push({tableId:d.value,fieldName:x.fieldName,fieldType:x.fieldType,fieldComment:x.fieldComment})}),await We(t)&&((B=window.$message)==null||B.success("操作成功"),I(),m.value=[]),l()},me=[{label:"字符串",value:"varchar"},{label:"长文本",value:"longtext"},{label:"长整数",value:"long"},{label:"整数",value:"int"},{label:"金额",value:"decimal"},{label:"浮点",value:"float"},{label:"日期",value:"datetime"},{label:"布尔型",value:"bool"}],ve=y([{key:"index",title:"序号",align:"center",width:80,render:(t,a)=>`${a+1}`},{title:"字段名称",key:"fieldName",render(t,a){return f(j,{key:a,value:t.fieldName,disabled:t.fieldName==="Id"||t.fieldName==="CreateTime"||t.fieldName==="UpdateTime",onUpdateValue(u){m.value[a].fieldName=u}})}},{title:"字段类型",key:"fieldType",render(t,a){return f(Ue,{key:a,options:me,disabled:t.fieldName==="Id"||t.fieldName==="CreateTime"||t.fieldName==="UpdateTime",value:t.fieldType,onUpdateValue(u){m.value[a].fieldType=u}})}},{title:"字段描述",key:"fieldComment",render(t,a){return f(j,{key:a,value:t.fieldComment,disabled:t.fieldName==="Id"||t.fieldName==="CreateTime"||t.fieldName==="UpdateTime",onUpdateValue(u){m.value[a].fieldComment=u}})}},{key:"actions",title:"操作",align:"center",render:t=>e(b,{justify:"space-around"},{default:()=>[e(H,{onPositiveClick:()=>pe(t.fieldName)},{default:()=>"确认删除该字段",trigger:()=>e(g,{disabled:t.fieldName==="Id"||t.fieldName==="CreateTime"||t.fieldName==="UpdateTime",size:"small"},{default:()=>[C("删除")]})})]})}]);async function I(){re(),h()}return I(),(t,a)=>{const u=Xe,w=lt,z=Ve("column-setting"),B=Fe,x=Ae,L=Y,D=Le,E=He,_e=De,ge=Ee;return te(),ae("div",it,[e(D,{cols:24,class:"h-full"},{default:s(()=>[e(L,{span:12},{default:s(()=>[e(x,{title:"数据表管理",bordered:!1,class:"h-full rounded-8px shadow-sm"},{default:s(()=>[$("div",rt,[e(c(b),{class:"pb-12px",justify:"space-between"},{default:s(()=>[e(c(b),null,{default:s(()=>[e(c(g),{type:"primary",onClick:oe},{default:s(()=>[e(u,{class:"mr-4px text-20px"}),C(" 新增 ")]),_:1})]),_:1}),e(c(b),{align:"center",size:18},{default:s(()=>[e(c(g),{size:"small",type:"primary",onClick:I},{default:s(()=>[e(w,{class:V(["mr-4px text-16px",{"animate-spin":c(o)}])},null,8,["class"]),C(" 刷新表格 ")]),_:1}),e(z,{columns:R.value,"onUpdate:columns":a[0]||(a[0]=N=>R.value=N)},null,8,["columns"])]),_:1})]),_:1}),e(c(b),null,{default:s(()=>[dt]),_:1}),e(B,{columns:R.value,data:T.value,remote:"",loading:c(o),"flex-height":"",class:"flex-1-hidden mt-5"},null,8,["columns","data","loading"])])]),_:1})]),_:1}),e(L,{span:12},{default:s(()=>[e(x,{title:"字段管理",bordered:!1,class:"h-full rounded-8px shadow-sm"},{default:s(()=>[$("div",ct,[e(c(b),{class:"pb-12px",justify:"space-between"},{default:s(()=>[e(c(b),null,{default:s(()=>[e(c(g),{type:"primary",onClick:a[1]||(a[1]=N=>ue())},{default:s(()=>[e(u,{class:"mr-4px text-20px"}),C(" 新增一行 ")]),_:1})]),_:1}),e(c(b),null,{default:s(()=>[e(c(g),{type:"primary",onClick:fe},{default:s(()=>[e(w,{class:V(["mr-4px text-16px",{"animate-spin":c(o)}])},null,8,["class"]),C(" 保存 ")]),_:1}),e(c(g),{type:"primary",onClick:ce},{default:s(()=>[e(w,{class:V(["mr-4px text-16px",{"animate-spin":c(o)}])},null,8,["class"]),C(" 重置 ")]),_:1})]),_:1})]),_:1}),e(c(b),null,{default:s(()=>[ut]),_:1}),e(B,{columns:ve.value,data:m.value,"flex-height":"",class:"flex-1-hidden mt-5"},null,8,["columns","data"])])]),_:1})]),_:1})]),_:1}),e(ge,{show:r.value,"onUpdate:show":a[4]||(a[4]=N=>r.value=N),preset:"card",title:"创建数据表",class:"w-700px"},{default:s(()=>[e(_e,{ref_key:"formRef",ref:k,"label-placement":"left","label-width":120,model:p.value,rules:P},{default:s(()=>[e(D,{cols:24,"x-gap":18},{default:s(()=>[e(E,{span:24,label:"数据表名",path:"tableName"},{default:s(()=>[e(c(j),{value:p.value.tableName,"onUpdate:value":a[2]||(a[2]=N=>p.value.tableName=N)},null,8,["value"])]),_:1}),e(E,{span:24,label:"数据表注释",path:"tableComment"},{default:s(()=>[e(c(j),{value:p.value.tableComment,"onUpdate:value":a[3]||(a[3]=N=>p.value.tableComment=N)},null,8,["value"])]),_:1})]),_:1}),e(c(b),{class:"w-full pt-16px",size:24,justify:"end"},{default:s(()=>[e(c(g),{class:"w-72px",onClick:se},{default:s(()=>[C("取消")]),_:1}),e(c(g),{class:"w-72px",type:"primary",onClick:ie},{default:s(()=>[C("确定")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}});export{vt as default};
